-- GigaChad Spy Professional Edition
-- Advanced Remote Monitoring System

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local HttpService = game:GetService("HttpService")
local CoreGui = game:GetService("CoreGui")
local TweenService = game:GetService("TweenService")

local localPlayer = Players.LocalPlayer

-- Professional Color Scheme (Dark Theme)
local COLORS = {
    -- Primary Colors
    DARK_1 = Color3.fromRGB(18, 18, 24),
    DARK_2 = Color3.fromRGB(28, 28, 36),
    DARK_3 = Color3.fromRGB(38, 38, 48),
    
    -- Accent Colors
    ACCENT_1 = Color3.fromRGB(0, 122, 255),
    ACCENT_2 = Color3.fromRGB(52, 199, 89),
    ACCENT_3 = Color3.fromRGB(255, 59, 48),
    ACCENT_4 = Color3.fromRGB(255, 149, 0),
    ACCENT_5 = Color3.fromRGB(175, 82, 222),
    
    -- Text Colors
    TEXT_PRIMARY = Color3.fromRGB(242, 242, 247),
    TEXT_SECONDARY = Color3.fromRGB(174, 174, 178),
    TEXT_TERTIARY = Color3.fromRGB(99, 99, 102),
    
    -- Status Colors
    SUCCESS = Color3.fromRGB(52, 199, 89),
    WARNING = Color3.fromRGB(255, 149, 0),
    ERROR = Color3.fromRGB(255, 59, 48),
    INFO = Color3.fromRGB(0, 122, 255)
}

-- Remote Type Colors
local REMOTE_COLORS = {
    EVENT_OUT = COLORS.ACCENT_1,
    EVENT_IN = Color3.fromRGB(0, 100, 210),
    FUNCTION_OUT = COLORS.ACCENT_5,
    FUNCTION_IN = Color3.fromRGB(140, 65, 180)
}

-- Configuration
local MAX_LOGS = 200
local AUTO_BLOCK_THRESHOLD = 5
local UPDATE_INTERVAL = 0.2

-- Data Storage
local spyData = {
    logs = {},
    blockedRemotes = {},
    autoBlockCount = {},
    selectedLog = nil,
    isHooked = false
}

-- Utility Functions
local function safeCall(func, errorMessage, ...)
    local success, result = pcall(func, ...)
    if not success then
        warn("[GigaChad Spy] " .. errorMessage .. " - " .. tostring(result))
        return nil
    end
    return result
end

local function deepCopy(t)
    local copy = {}
    for k, v in pairs(t) do
        if type(v) == "table" then
            copy[k] = deepCopy(v)
        else
            copy[k] = v
        end
    end
    return copy
end

local function formatValue(value, depth)
    depth = depth or 0
    if depth > 2 then return "..." end
    
    local valueType = typeof(value)
    
    if valueType == "table" then
        local parts = {}
        for k, v in pairs(value) do
            if #parts < 8 then
                table.insert(parts, string.format("[%s] = %s", formatValue(k, depth + 1), formatValue(v, depth + 1)))
            else
                table.insert(parts, "...")
                break
            end
        end
        return "{" .. table.concat(parts, ", ") .. "}"
    elseif valueType == "string" then
        if #value > 50 then
            return string.format("%q...", string.sub(value, 1, 50))
        end
        return string.format("%q", value)
    elseif valueType == "number" then
        return tostring(value)
    elseif valueType == "boolean" then
        return tostring(value)
    elseif valueType == "Vector3" then
        return string.format("Vector3.new(%.2f, %.2f, %.2f)", value.X, value.Y, value.Z)
    elseif valueType == "CFrame" then
        local x, y, z = value.Position.X, value.Position.Y, value.Position.Z
        return string.format("CFrame.new(%.2f, %.2f, %.2f)", x, y, z)
    elseif valueType == "Color3" then
        return string.format("Color3.new(%.2f, %.2f, %.2f)", value.R, value.G, value.B)
    elseif valueType == "Instance" then
        if value:IsA("Player") then
            return string.format('game.Players:FindFirstChild("%s")', value.Name)
        else
            return string.format('game:GetService("%s"):FindFirstChild("%s")', value.ClassName, value.Name)
        end
    elseif valueType == "nil" then
        return "nil"
    else
        return string.format("--[[ %s ]]", valueType)
    end
end

local function generateCode(remoteData)
    if not remoteData then return "-- Select a remote to view code --" end
    
    local argsString = ""
    if #remoteData.args > 0 then
        local argStrings = {}
        for i, arg in ipairs(remoteData.args) do
            table.insert(argStrings, string.format("    [%d] = %s", i, formatValue(arg)))
        end
        argsString = "local args = {\n" .. table.concat(argStrings, ",\n") .. "\n}"
    else
        argsString = "local args = {}"
    end

    local callString = ""
    if remoteData.isFunction then
        if remoteData.direction == "out" then
            callString = string.format('%s:InvokeServer(unpack(args))', remoteData.remotePath)
        else
            callString = string.format('-- Incoming function call: %s', remoteData.remotePath)
        end
    else
        if remoteData.direction == "out" then
            callString = string.format('%s:FireServer(unpack(args))', remoteData.remotePath)
        else
            callString = string.format('-- Incoming event: %s', remoteData.remotePath)
        end
    end

    return argsString .. "\n" .. callString
end

-- UI Creation Functions
local function createProfessionalFrame(name, size, position, parent, color)
    local frame = Instance.new("Frame")
    frame.Name = name
    frame.Size = size
    frame.Position = position
    frame.BackgroundColor3 = color or COLORS.DARK_2
    frame.BorderSizePixel = 0
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 8)
    corner.Parent = frame
    
    if parent then
        frame.Parent = parent
    end
    
    return frame
end

local function createProfessionalButton(name, size, position, parent, text, color)
    local button = Instance.new("TextButton")
    button.Name = name
    button.Size = size
    button.Position = position
    button.BackgroundColor3 = color or COLORS.ACCENT_1
    button.Text = text
    button.TextColor3 = COLORS.TEXT_PRIMARY
    button.TextSize = 14
    button.Font = Enum.Font.Gotham
    button.BorderSizePixel = 0
    button.AutoButtonColor = false
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 6)
    corner.Parent = button
    
    -- Hover effects
    local originalColor = button.BackgroundColor3
    button.MouseEnter:Connect(function()
        button.BackgroundColor3 = originalColor:Lerp(COLORS.TEXT_PRIMARY, 0.1)
    end)
    
    button.MouseLeave:Connect(function()
        button.BackgroundColor3 = originalColor
    end)
    
    if parent then
        button.Parent = parent
    end
    
    return button
end

local function createProfessionalLabel(name, size, position, parent, text, textSize)
    local label = Instance.new("TextLabel")
    label.Name = name
    label.Size = size
    label.Position = position
    label.BackgroundTransparency = 1
    label.Text = text
    label.TextColor3 = COLORS.TEXT_PRIMARY
    label.TextSize = textSize or 14
    label.Font = Enum.Font.Gotham
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.TextWrapped = true
    
    if parent then
        label.Parent = parent
    end
    
    return label
end

-- Main GUI Creation
local function createMainGUI()
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "GigaChadSpyPro"
    screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    screenGui.ResetOnSpawn = false
    screenGui.Parent = CoreGui

    -- Floating Activation Button
    local floatButton = createProfessionalButton(
        "FloatButton",
        UDim2.new(0, 60, 0, 60),
        UDim2.new(0, 20, 0.5, -30),
        screenGui,
        "SPY",
        COLORS.ACCENT_1
    )
    floatButton.TextSize = 12
    floatButton.Visible = true

    -- Main Window
    local mainFrame = createProfessionalFrame(
        "MainFrame",
        UDim2.new(0.9, 0, 0.85, 0),
        UDim2.new(0.05, 0, 0.075, 0),
        screenGui,
        COLORS.DARK_1
    )
    mainFrame.Visible = false

    -- Header
    local header = createProfessionalFrame(
        "Header",
        UDim2.new(1, 0, 0, 50),
        UDim2.new(0, 0, 0, 0),
        mainFrame,
        COLORS.DARK_3
    )

    local title = createProfessionalLabel(
        "Title",
        UDim2.new(0.7, 0, 1, 0),
        UDim2.new(0, 15, 0, 0),
        header,
        "GIGACHAD SPY PROFESSIONAL",
        16
    )
    title.Font = Enum.Font.GothamBold

    local closeButton = createProfessionalButton(
        "CloseButton",
        UDim2.new(0, 40, 0, 40),
        UDim2.new(1, -45, 0.5, -20),
        header,
        "√ó",
        COLORS.ERROR
    )
    closeButton.TextSize = 18

    -- Content Area
    local contentFrame = createProfessionalFrame(
        "ContentFrame",
        UDim2.new(1, -20, 1, -70),
        UDim2.new(0, 10, 0, 60),
        mainFrame,
        COLORS.DARK_1
    )
    contentFrame.BackgroundTransparency = 1

    -- Left Panel - Remote List
    local leftPanel = createProfessionalFrame(
        "LeftPanel",
        UDim2.new(0.38, 0, 1, 0),
        UDim2.new(0, 0, 0, 0),
        contentFrame,
        COLORS.DARK_2
    )

    local listHeader = createProfessionalFrame(
        "ListHeader",
        UDim2.new(1, 0, 0, 40),
        UDim2.new(0, 0, 0, 0),
        leftPanel,
        COLORS.DARK_3
    )

    createProfessionalLabel(
        "ListTitle",
        UDim2.new(1, -10, 1, 0),
        UDim2.new(0, 10, 0, 0),
        listHeader,
        "ACTIVE REMOTES",
        14
    )

    local remotesList = Instance.new("ScrollingFrame")
    remotesList.Name = "RemotesList"
    remotesList.Size = UDim2.new(1, 0, 1, -80)
    remotesList.Position = UDim2.new(0, 0, 0, 45)
    remotesList.BackgroundColor3 = COLORS.DARK_2
    remotesList.BackgroundTransparency = 1
    remotesList.ScrollBarThickness = 4
    remotesList.ScrollBarImageColor3 = COLORS.ACCENT_1
    remotesList.Parent = leftPanel

    local listLayout = Instance.new("UIListLayout")
    listLayout.Padding = UDim.new(0, 6)
    listLayout.Parent = remotesList

    -- Right Panel - Code & Controls
    local rightPanel = createProfessionalFrame(
        "RightPanel",
        UDim2.new(0.6, 0, 1, 0),
        UDim2.new(0.4, 0, 0, 0),
        contentFrame,
        COLORS.DARK_2
    )

    local codeHeader = createProfessionalFrame(
        "CodeHeader",
        UDim2.new(1, 0, 0, 40),
        UDim2.new(0, 0, 0, 0),
        rightPanel,
        COLORS.DARK_3
    )

    createProfessionalLabel(
        "CodeTitle",
        UDim2.new(1, -10, 1, 0),
        UDim2.new(0, 10, 0, 0),
        codeHeader,
        "GENERATED CODE",
        14
    )

    local codeContainer = createProfessionalFrame(
        "CodeContainer",
        UDim2.new(1, -10, 0.6, -10),
        UDim2.new(0, 5, 0, 45),
        rightPanel,
        COLORS.DARK_1
    )

    local codeBox = Instance.new("ScrollingFrame")
    codeBox.Name = "CodeBox"
    codeBox.Size = UDim2.new(1, -10, 1, -10)
    codeBox.Position = UDim2.new(0, 5, 0, 5)
    codeBox.BackgroundTransparency = 1
    codeBox.ScrollBarThickness = 4
    codeBox.ScrollBarImageColor3 = COLORS.ACCENT_1
    codeBox.Parent = codeContainer

    local codeText = createProfessionalLabel(
        "CodeText",
        UDim2.new(1, 0, 1, 0),
        UDim2.new(0, 0, 0, 0),
        codeBox,
        "-- Select a remote to view code --",
        13
    )
    codeText.TextYAlignment = Enum.TextYAlignment.Top
    codeText.TextXAlignment = Enum.TextXAlignment.Left

    -- Control Panel
    local controlPanel = createProfessionalFrame(
        "ControlPanel",
        UDim2.new(1, -10, 0.35, -10),
        UDim2.new(0, 5, 0.6, 5),
        rightPanel,
        COLORS.DARK_3
    )

    local controlGrid = Instance.new("UIGridLayout")
    controlGrid.CellSize = UDim2.new(0.5, -8, 0.33, -8)
    controlGrid.CellPadding = UDim2.new(0, 6, 0, 6)
    controlGrid.Parent = controlPanel

    -- Control Buttons
    local controls = {
        {Name = "Execute", Text = "Execute", Color = COLORS.ACCENT_2},
        {Name = "Copy", Text = "Copy Code", Color = COLORS.ACCENT_1},
        {Name = "Block", Text = "Block", Color = COLORS.ERROR},
        {Name = "Source", Text = "Source Info", Color = COLORS.ACCENT_5},
        {Name = "Clear", Text = "Clear Logs", Color = COLORS.WARNING},
        {Name = "UnblockAll", Text = "Unblock All", Color = COLORS.ACCENT_2}
    }

    for _, control in pairs(controls) do
        createProfessionalButton(
            control.Name,
            UDim2.new(1, 0, 1, 0),
            UDim2.new(0, 0, 0, 0),
            controlPanel,
            control.Text,
            control.Color
        )
    end

    -- Status Bar
    local statusBar = createProfessionalFrame(
        "StatusBar",
        UDim2.new(1, 0, 0, 30),
        UDim2.new(0, 0, 1, -30),
        leftPanel,
        COLORS.DARK_3
    )

    local statusLabel = createProfessionalLabel(
        "StatusLabel",
        UDim2.new(1, -10, 1, 0),
        UDim2.new(0, 10, 0, 0),
        statusBar,
        "Monitoring: 0 remotes | Blocked: 0",
        12
    )
    statusLabel.TextColor3 = COLORS.TEXT_SECONDARY

    return {
        ScreenGui = screenGui,
        MainFrame = mainFrame,
        FloatButton = floatButton,
        CloseButton = closeButton,
        RemotesList = remotesList,
        CodeText = codeText,
        ControlPanel = controlPanel,
        StatusLabel = statusLabel
    }
end

-- Advanced Hook System (Namecall Method)
local function initializeHooks()
    return safeCall(function()
        if spyData.isHooked then return true end
        
        local mt = getrawmetatable(game)
        if not mt then return false end
        
        local oldNamecall = mt.__namecall
        local oldIndex = mt.__index
        
        -- Hook outgoing calls
        if oldNamecall then
            mt.__namecall = newcclosure(function(self, ...)
                local method = getnamecallmethod()
                local args = {...}
                
                if (method == "FireServer" or method == "InvokeServer") and 
                   (self.ClassName == "RemoteEvent" or self.ClassName == "RemoteFunction") then
                    
                    local remotePath = self:GetFullName()
                    
                    if not spyData.blockedRemotes[remotePath] then
                        local logEntry = {
                            remote = self,
                            remotePath = remotePath,
                            args = args,
                            isFunction = method == "InvokeServer",
                            direction = "out",
                            timestamp = tick(),
                            callId = HttpService:GenerateGUID(false)
                        }
                        
                        table.insert(spyData.logs, 1, logEntry)
                        
                        -- Auto-blocking
                        spyData.autoBlockCount[remotePath] = (spyData.autoBlockCount[remotePath] or 0) + 1
                        if spyData.autoBlockCount[remotePath] >= AUTO_BLOCK_THRESHOLD then
                            spyData.blockedRemotes[remotePath] = true
                        end
                        
                        -- Limit logs
                        if #spyData.logs > MAX_LOGS then
                            table.remove(spyData.logs, #spyData.logs)
                        end
                    end
                end
                
                return oldNamecall(self, ...)
            end)
        end
        
        -- Hook incoming events
        local function hookIncomingRemote(remote)
            if remote:IsA("RemoteEvent") then
                remote.OnClientEvent:Connect(function(...)
                    local args = {...}
                    local remotePath = remote:GetFullName()
                    
                    if not spyData.blockedRemotes[remotePath] then
                        local logEntry = {
                            remote = remote,
                            remotePath = remotePath,
                            args = args,
                            isFunction = false,
                            direction = "in",
                            timestamp = tick(),
                            callId = HttpService:GenerateGUID(false)
                        }
                        
                        table.insert(spyData.logs, 1, logEntry)
                        
                        if #spyData.logs > MAX_LOGS then
                            table.remove(spyData.logs, #spyData.logs)
                        end
                    end
                end)
            elseif remote:IsA("RemoteFunction") then
                local oldOnClientInvoke = remote.OnClientInvoke
                remote.OnClientInvoke = function(...)
                    local args = {...}
                    local remotePath = remote:GetFullName()
                    
                    if not spyData.blockedRemotes[remotePath] then
                        local logEntry = {
                            remote = remote,
                            remotePath = remotePath,
                            args = args,
                            isFunction = true,
                            direction = "in",
                            timestamp = tick(),
                            callId = HttpService:GenerateGUID(false)
                        }
                        
                        table.insert(spyData.logs, 1, logEntry)
                        
                        if #spyData.logs > MAX_LOGS then
                            table.remove(spyData.logs, #spyData.logs)
                        end
                    end
                    
                    if oldOnClientInvoke then
                        return oldOnClientInvoke(...)
                    end
                    return nil
                end
            end
        end
        
        -- Hook existing remotes
        local function hookExistingRemotes(parent)
            for _, child in pairs(parent:GetChildren()) do
                if child:IsA("RemoteEvent") or child:IsA("RemoteFunction") then
                    hookIncomingRemote(child)
                end
                hookExistingRemotes(child)
            end
        end
        
        hookExistingRemotes(game)
        
        -- Hook new remotes
        game.DescendantAdded:Connect(function(descendant)
            if descendant:IsA("RemoteEvent") or descendant:IsA("RemoteFunction") then
                hookIncomingRemote(descendant)
            end
        end)
        
        spyData.isHooked = true
        return true
    end, "initializeHooks failed") or false
end

-- Action Functions
local function executeRemote(remoteData)
    if not remoteData then return false, "No remote data" end
    
    return safeCall(function()
        local args = {}
        for i, arg in ipairs(remoteData.args) do
            args[i] = arg
        end
        
        if remoteData.isFunction then
            if remoteData.direction == "out" then
                return true, remoteData.remote:InvokeServer(unpack(args))
            else
                return false, "Cannot execute incoming function calls"
            end
        else
            if remoteData.direction == "out" then
                remoteData.remote:FireServer(unpack(args))
                return true, "Executed successfully"
            else
                return false, "Cannot execute incoming event calls"
            end
        end
    end, "executeRemote failed")
end

local function toggleBlockRemote(remotePath)
    return safeCall(function()
        if spyData.blockedRemotes[remotePath] then
            spyData.blockedRemotes[remotePath] = nil
            spyData.autoBlockCount[remotePath] = nil
            return false
        else
            spyData.blockedRemotes[remotePath] = true
            return true
        end
    end, "toggleBlockRemote failed") or false
end

local function getSourceInfo(remoteData)
    return safeCall(function()
        return string.format("Remote Path: %s\nType: %s\nDirection: %s\nTimestamp: %.3f\nArguments: %d",
            remoteData.remotePath,
            remoteData.isFunction and "RemoteFunction" or "RemoteEvent",
            remoteData.direction,
            remoteData.timestamp,
            #remoteData.args
        )
    end, "getSourceInfo failed") or "Error retrieving source information"
end

-- GUI Update Function
local function updateGUI(guiElements)
    return safeCall(function()
        local remotesList = guiElements.RemotesList
        local codeText = guiElements.CodeText
        local statusLabel = guiElements.StatusLabel
        
        -- Clear existing list
        for _, child in pairs(remotesList:GetChildren()) do
            if child:IsA("Frame") then
                child:Destroy()
            end
        end

        -- Add remote entries
        for i, logEntry in ipairs(spyData.logs) do
            local remoteCard = createProfessionalFrame(
                "RemoteCard_" .. i,
                UDim2.new(1, -8, 0, 70),
                UDim2.new(0, 4, 0, (i-1)*76),
                remotesList,
                COLORS.DARK_3
            )
            
            -- Determine card color based on type and direction
            local cardColor = logEntry.direction == "out" and 
                             (logEntry.isFunction and REMOTE_COLORS.FUNCTION_OUT or REMOTE_COLORS.EVENT_OUT) or
                             (logEntry.isFunction and REMOTE_COLORS.FUNCTION_IN or REMOTE_COLORS.EVENT_IN)
            
            remoteCard.BackgroundColor3 = cardColor

            -- Remote path (truncated if too long)
            local pathText = logEntry.remotePath
            if #pathText > 35 then
                pathText = "..." .. string.sub(pathText, -32)
            end
            
            createProfessionalLabel(
                "PathLabel",
                UDim2.new(0.8, 0, 0.5, 0),
                UDim2.new(0, 8, 0, 5),
                remoteCard,
                pathText,
                12
            )

            -- Type and direction info
            local typeText = string.format("%s ‚Ä¢ %s ‚Ä¢ %d args",
                logEntry.isFunction and "FUNCTION" or "EVENT",
                logEntry.direction:upper(),
                #logEntry.args
            )
            
            createProfessionalLabel(
                "InfoLabel",
                UDim2.new(0.8, 0, 0.4, 0),
                UDim2.new(0, 8, 0.5, 0),
                remoteCard,
                typeText,
                10
            ).TextColor3 = COLORS.TEXT_SECONDARY

            -- Block indicator
            if spyData.blockedRemotes[logEntry.remotePath] then
                local blockIndicator = createProfessionalFrame(
                    "BlockIndicator",
                    UDim2.new(0, 6, 0, 6),
                    UDim2.new(1, -12, 0, 6),
                    remoteCard,
                    COLORS.ERROR
                )
            end

            -- Click handler
            remoteCard.MouseButton1Click:Connect(function()
                spyData.selectedLog = logEntry
                local code = generateCode(logEntry)
                codeText.Text = code
                
                -- Update block button
                local blockButton = guiElements.ControlPanel:FindFirstChild("Block")
                if blockButton then
                    local isBlocked = spyData.blockedRemotes[logEntry.remotePath]
                    blockButton.Text = isBlocked and "Unblock" or "Block"
                    blockButton.BackgroundColor3 = isBlocked and COLORS.ACCENT_2 or COLORS.ERROR
                end
            end)
        end
        
        remotesList.CanvasSize = UDim2.new(0, 0, 0, #spyData.logs * 76)
        
        -- Update status
        local blockedCount = 0
        for _ in pairs(spyData.blockedRemotes) do
            blockedCount = blockedCount + 1
        end
        
        statusLabel.Text = string.format("Monitoring: %d remotes | Blocked: %d", #spyData.logs, blockedCount)
        
        return true
    end, "updateGUI failed") or false
end

-- Main Initialization
local function initializeSpy()
    print("[GigaChad Spy] Initializing Professional Edition...")
    
    local guiElements = createMainGUI()
    if not guiElements then
        error("Failed to create GUI elements")
    end

    -- Safe button connection
    local function connectControl(buttonName, callback)
        local button = guiElements.ControlPanel:FindFirstChild(buttonName)
        if button then
            button.MouseButton1Click:Connect(function()
                safeCall(callback, "Control button failed: " .. buttonName)
            end)
        end
    end

    -- UI Event Handlers
    guiElements.FloatButton.MouseButton1Click:Connect(function()
        guiElements.MainFrame.Visible = not guiElements.MainFrame.Visible
        guiElements.FloatButton.Visible = not guiElements.MainFrame.Visible
    end)

    guiElements.CloseButton.MouseButton1Click:Connect(function()
        guiElements.MainFrame.Visible = false
        guiElements.FloatButton.Visible = true
    end)

    -- Control Handlers
    connectControl("Execute", function()
        if spyData.selectedLog then
            local success, result = executeRemote(spyData.selectedLog)
            if success then
                guiElements.CodeText.Text = generateCode(spyData.selectedLog) .. "\n\n‚úÖ Execution successful"
                if result ~= nil and result ~= true then
                    guiElements.CodeText.Text = guiElements.CodeText.Text .. "\nReturn: " .. formatValue(result)
                end
            else
                guiElements.CodeText.Text = generateCode(spyData.selectedLog) .. "\n\n‚ùå Execution failed: " .. tostring(result)
            end
        end
    end)

    connectControl("Copy", function()
        if spyData.selectedLog then
            local code = generateCode(spyData.selectedLog)
            if setclipboard then
                setclipboard(code)
                guiElements.CodeText.Text = code .. "\n\n‚úÖ Code copied to clipboard"
            else
                guiElements.CodeText.Text = code .. "\n\n‚ùå Clipboard not available"
            end
        end
    end)

    connectControl("Block", function()
        if spyData.selectedLog then
            local isBlocked = toggleBlockRemote(spyData.selectedLog.remotePath)
            local blockButton = guiElements.ControlPanel:FindFirstChild("Block")
            if blockButton then
                blockButton.Text = isBlocked and "Unblock" or "Block"
                blockButton.BackgroundColor3 = isBlocked and COLORS.ACCENT_2 or COLORS.ERROR
            end
            guiElements.CodeText.Text = generateCode(spyData.selectedLog) .. 
                           (isBlocked and "\n\n‚úÖ Remote blocked" : "\n\n‚úÖ Remote unblocked")
        end
    end)

    connectControl("Source", function()
        if spyData.selectedLog then
            local sourceInfo = getSourceInfo(spyData.selectedLog)
            guiElements.CodeText.Text = "üìä SOURCE INFORMATION\n" .. sourceInfo .. "\n\n" .. generateCode(spyData.selectedLog)
        end
    end)

    connectControl("Clear", function()
        spyData.logs = {}
        spyData.selectedLog = nil
        guiElements.CodeText.Text = "-- Select a remote to view code --"
        updateGUI(guiElements)
    end)

    connectControl("UnblockAll", function()
        spyData.blockedRemotes = {}
        spyData.autoBlockCount = {}
        if spyData.selectedLog then
            local blockButton = guiElements.ControlPanel:FindFirstChild("Block")
            if blockButton then
                blockButton.Text = "Block"
                blockButton.BackgroundColor3 = COLORS.ERROR
            end
        end
        guiElements.CodeText.Text = (spyData.selectedLog and generateCode(spyData.selectedLog) or "") .. "\n\n‚úÖ All blocks cleared"
        updateGUI(guiElements)
    end)

    -- Initialize hooks
    local hookSuccess = initializeHooks()
    if not hookSuccess then
        guiElements.CodeText.Text = "‚ùå Failed to initialize hooks\nSome features may not work"
    end

    -- Auto-update GUI
    local updateConnection
    updateConnection = RunService.Heartbeat:Connect(function()
        if guiElements.ScreenGui.Parent then
            updateGUI(guiElements)
        else
            updateConnection:Disconnect()
        end
    end)

    return guiElements.ScreenGui
end

-- Execution
if not _G.GigaChadSpyProLoaded then
    _G.GigaChadSpyProLoaded = true
    local success, result = pcall(initializeSpy)
    if success then
        print("[GigaChad Spy] ‚úÖ Professional Edition loaded successfully")
    else
        warn("[GigaChad Spy] ‚ùå Failed to load: " .. tostring(result))
        _G.GigaChadSpyProLoaded = false
    end
else
    print("[GigaChad Spy] ‚ö†Ô∏è Already loaded")
end
