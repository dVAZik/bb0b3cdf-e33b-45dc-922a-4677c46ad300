local GigaChadSpy = Instance.new("ScreenGui")
local FloatingButton = Instance.new("TextButton")
local MainFrame = Instance.new("Frame")
local TopBar = Instance.new("Frame")
local Title = Instance.new("TextLabel")
local CloseButton = Instance.new("TextButton")
local Content = Instance.new("Frame")
local LeftPanel = Instance.new("ScrollingFrame")
local RemoteTemplate = Instance.new("Frame")
local RemoteIcon = Instance.new("TextLabel")
local RemoteName = Instance.new("TextLabel")
local RemoteType = Instance.new("TextLabel")
local RightPanel = Instance.new("Frame")
local CodeFrame = Instance.new("ScrollingFrame")
local CodeTemplate = Instance.new("TextLabel")
local ButtonsFrame = Instance.new("Frame")
local ReFireButton = Instance.new("TextButton")
local CopyButton = Instance.new("TextButton")
local BlockButton = Instance.new("TextButton")
local ClearLogsButton = Instance.new("TextButton")
local ClearBlocksButton = Instance.new("TextButton")
local AutoBlockButton = Instance.new("TextButton")
local DecompileButton = Instance.new("TextButton")

-- Properties
GigaChadSpy.Name = "GigaChadSpy"
GigaChadSpy.Parent = game:GetService("CoreGui") or game:GetService("Players").LocalPlayer:WaitForChild("PlayerGui")
GigaChadSpy.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
GigaChadSpy.ResetOnSpawn = false

-- Floating Button
FloatingButton.Name = "FloatingButton"
FloatingButton.Parent = GigaChadSpy
FloatingButton.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
FloatingButton.BorderSizePixel = 0
FloatingButton.Position = UDim2.new(0, 20, 0, 20)
FloatingButton.Size = UDim2.new(0, 70, 0, 70)
FloatingButton.ZIndex = 100
FloatingButton.Font = Enum.Font.Cartoon
FloatingButton.Text = "GCS"
FloatingButton.TextColor3 = Color3.fromRGB(255, 255, 255)
FloatingButton.TextScaled = true
FloatingButton.RichText = true
FloatingButton.Visible = true
FloatingButton.AutoButtonColor = true

-- Main Frame
MainFrame.Name = "MainFrame"
MainFrame.Parent = GigaChadSpy
MainFrame.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
MainFrame.BorderSizePixel = 1
MainFrame.BorderColor3 = Color3.fromRGB(50, 50, 50)
MainFrame.Position = UDim2.new(0.1, 0, 0.1, 0)
MainFrame.Size = UDim2.new(0.8, 0, 0.8, 0)
MainFrame.Visible = false
MainFrame.ClipsDescendants = true

-- Top Bar
TopBar.Name = "TopBar"
TopBar.Parent = MainFrame
TopBar.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
TopBar.BorderSizePixel = 0
TopBar.Size = UDim2.new(1, 0, 0, 45)

Title.Name = "Title"
Title.Parent = TopBar
Title.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
Title.BorderSizePixel = 0
Title.Size = UDim2.new(0.8, 0, 1, 0)
Title.Font = Enum.Font.Cartoon
Title.Text = "<b>GigaChad Spy</b>"
Title.TextColor3 = Color3.fromRGB(255, 215, 0)
Title.TextScaled = true
Title.RichText = true
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.Position = UDim2.new(0.02, 0, 0, 0)

CloseButton.Name = "CloseButton"
CloseButton.Parent = TopBar
CloseButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
CloseButton.BorderSizePixel = 0
CloseButton.Position = UDim2.new(0.92, 0, 0.1, 0)
CloseButton.Size = UDim2.new(0.07, 0, 0.8, 0)
CloseButton.Font = Enum.Font.Cartoon
CloseButton.Text = "‚úï"
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.TextScaled = true
CloseButton.RichText = true
CloseButton.AutoButtonColor = true

-- Content
Content.Name = "Content"
Content.Parent = MainFrame
Content.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
Content.BorderSizePixel = 0
Content.Position = UDim2.new(0, 0, 0, 45)
Content.Size = UDim2.new(1, 0, 1, -45)

-- Left Panel
LeftPanel.Name = "LeftPanel"
LeftPanel.Parent = Content
LeftPanel.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
LeftPanel.BorderSizePixel = 1
LeftPanel.BorderColor3 = Color3.fromRGB(40, 40, 40)
LeftPanel.Size = UDim2.new(0.4, 0, 1, 0)
LeftPanel.CanvasSize = UDim2.new(0, 0, 0, 0)
LeftPanel.ScrollBarThickness = 6
LeftPanel.ScrollBarImageColor3 = Color3.fromRGB(80, 80, 80)
LeftPanel.VerticalScrollBarInset = Enum.ScrollBarInset.Always

-- Remote Template
RemoteTemplate.Name = "RemoteTemplate"
RemoteTemplate.Parent = LeftPanel
RemoteTemplate.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
RemoteTemplate.BorderSizePixel = 1
RemoteTemplate.BorderColor3 = Color3.fromRGB(50, 50, 50)
RemoteTemplate.Size = UDim2.new(1, -12, 0, 65)
RemoteTemplate.Visible = false
RemoteTemplate.AutoButtonColor = false

RemoteIcon.Name = "RemoteIcon"
RemoteIcon.Parent = RemoteTemplate
RemoteIcon.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
RemoteIcon.BorderSizePixel = 1
RemoteIcon.BorderColor3 = Color3.fromRGB(60, 60, 60)
RemoteIcon.Position = UDim2.new(0, 8, 0, 8)
RemoteIcon.Size = UDim2.new(0, 50, 0, 50)
RemoteIcon.Font = Enum.Font.Cartoon
RemoteIcon.Text = "üîç"
RemoteIcon.TextColor3 = Color3.fromRGB(255, 255, 255)
RemoteIcon.TextScaled = true
RemoteIcon.RichText = true

RemoteName.Name = "RemoteName"
RemoteName.Parent = RemoteTemplate
RemoteName.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
RemoteName.BorderSizePixel = 0
RemoteName.Position = UDim2.new(0, 65, 0, 8)
RemoteName.Size = UDim2.new(1, -70, 0, 25)
RemoteName.Font = Enum.Font.Cartoon
RemoteName.Text = "RemoteName"
RemoteName.TextColor3 = Color3.fromRGB(255, 255, 255)
RemoteName.TextScaled = true
RemoteName.RichText = true
RemoteName.TextXAlignment = Enum.TextXAlignment.Left
RemoteName.TextYAlignment = Enum.TextYAlignment.Top

RemoteType.Name = "RemoteType"
RemoteType.Parent = RemoteTemplate
RemoteType.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
RemoteType.BorderSizePixel = 0
RemoteType.Position = UDim2.new(0, 65, 0, 35)
RemoteType.Size = UDim2.new(1, -70, 0, 22)
RemoteType.Font = Enum.Font.Cartoon
RemoteType.Text = "Event ‚Üí Server"
RemoteType.TextColor3 = Color3.fromRGB(200, 200, 200)
RemoteType.TextScaled = true
RemoteType.RichText = true
RemoteType.TextXAlignment = Enum.TextXAlignment.Left

-- Right Panel
RightPanel.Name = "RightPanel"
RightPanel.Parent = Content
RightPanel.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
RightPanel.BorderSizePixel = 1
RightPanel.BorderColor3 = Color3.fromRGB(40, 40, 40)
RightPanel.Position = UDim2.new(0.4, 0, 0, 0)
RightPanel.Size = UDim2.new(0.6, 0, 1, 0)

CodeFrame.Name = "CodeFrame"
CodeFrame.Parent = RightPanel
CodeFrame.BackgroundColor3 = Color3.fromRGB(10, 10, 10)
CodeFrame.BorderSizePixel = 1
CodeFrame.BorderColor3 = Color3.fromRGB(40, 40, 40)
CodeFrame.Size = UDim2.new(1, 0, 0.7, 0)
CodeFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
CodeFrame.ScrollBarThickness = 6
CodeFrame.ScrollBarImageColor3 = Color3.fromRGB(80, 80, 80)
CodeFrame.VerticalScrollBarInset = Enum.ScrollBarInset.Always

CodeTemplate.Name = "CodeTemplate"
CodeTemplate.Parent = CodeFrame
CodeTemplate.BackgroundColor3 = Color3.fromRGB(10, 10, 10)
CodeTemplate.BorderSizePixel = 0
CodeTemplate.Size = UDim2.new(1, -10, 0, 25)
CodeTemplate.Visible = false
CodeTemplate.Font = Enum.Font.Code
CodeTemplate.Text = "local data = {}"
CodeTemplate.TextColor3 = Color3.fromRGB(220, 220, 220)
CodeTemplate.TextSize = 14
CodeTemplate.RichText = false
CodeTemplate.TextXAlignment = Enum.TextXAlignment.Left
CodeTemplate.TextYAlignment = Enum.TextYAlignment.Top
CodeTemplate.TextWrapped = true

ButtonsFrame.Name = "ButtonsFrame"
ButtonsFrame.Parent = RightPanel
ButtonsFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
ButtonsFrame.BorderSizePixel = 1
ButtonsFrame.BorderColor3 = Color3.fromRGB(45, 45, 45)
ButtonsFrame.Position = UDim2.new(0, 0, 0.7, 0)
ButtonsFrame.Size = UDim2.new(1, 0, 0.3, 0)

-- Buttons
local function CreateButton(name, text, position, size)
    local button = Instance.new("TextButton")
    button.Name = name
    button.Parent = ButtonsFrame
    button.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
    button.BorderSizePixel = 1
    button.BorderColor3 = Color3.fromRGB(60, 60, 60)
    button.Position = position
    button.Size = size
    button.Font = Enum.Font.Cartoon
    button.Text = text
    button.TextColor3 = Color3.fromRGB(255, 255, 255)
    button.TextScaled = true
    button.RichText = true
    button.AutoButtonColor = true
    return button
end

ReFireButton = CreateButton("ReFireButton", "üîÑ Refire", UDim2.new(0.02, 0, 0.05, 0), UDim2.new(0.3, -5, 0.4, -5))
CopyButton = CreateButton("CopyButton", "üìã Copy", UDim2.new(0.34, 0, 0.05, 0), UDim2.new(0.3, -5, 0.4, -5))
BlockButton = CreateButton("BlockButton", "üö´ Block", UDim2.new(0.66, 0, 0.05, 0), UDim2.new(0.3, -5, 0.4, -5))
ClearLogsButton = CreateButton("ClearLogsButton", "üóëÔ∏è Clear Logs", UDim2.new(0.02, 0, 0.5, 0), UDim2.new(0.3, -5, 0.4, -5))
ClearBlocksButton = CreateButton("ClearBlocksButton", "üîì Clear Blocks", UDim2.new(0.34, 0, 0.5, 0), UDim2.new(0.3, -5, 0.4, -5))
AutoBlockButton = CreateButton("AutoBlockButton", "ü§ñ Auto: OFF", UDim2.new(0.66, 0, 0.5, 0), UDim2.new(0.3, -5, 0.4, -5))
DecompileButton = CreateButton("DecompileButton", "üîç Decompile", UDim2.new(0.02, 0, 0.85, 0), UDim2.new(0.96, 0, 0.2, -5))

-- Spy Logic
local GigaChadSpy = {}
GigaChadSpy.Remotes = {}
GigaChadSpy.BlockedRemotes = {}
GigaChadSpy.MaxLogs = 200
GigaChadSpy.AutoBlock = false
GigaChadSpy.CurrentRemote = nil
GigaChadSpy.IsHooked = false

-- Safe GetPath function
function GigaChadSpy.GetPath(instance)
    local success, path = pcall(function()
        local pathParts = {}
        local current = instance
        
        while current and current ~= game do
            if not pcall(function() return current.Name end) then
                return "InvalidInstance"
            end
            table.insert(pathParts, 1, current.Name)
            current = current.Parent
            if not current then break end
        end
        
        if #pathParts == 0 then
            return "UnknownPath"
        end
        
        local parentService = "ReplicatedStorage"
        if instance.Parent then
            parentService = tostring(instance.Parent.ClassName)
        end
        
        return "game:GetService(\"" .. parentService .. "\")" .. table.concat(pathParts, ".")
    end)
    
    return success and path or "UnknownPath"
end

-- Improved SerializeValue with better error handling
function GigaChadSpy.SerializeValue(value, depth)
    depth = depth or 0
    if depth > 5 then return "\"<max_depth>\"\" end
    
    local valueType = typeof(value)
    
    local success, result = pcall(function()
        if valueType == "string" then
            return "\"" .. tostring(value):gsub("\"", "\\\"") .. "\""
        elseif valueType == "number" then
            if value == math.huge then
                return "math.huge"
            elseif value == -math.huge then
                return "-math.huge"
            elseif value ~= value then -- NaN
                return "0/0"
            else
                return tostring(value)
            end
        elseif valueType == "boolean" then
            return tostring(value)
        elseif valueType == "table" then
            local parts = {}
            local count = 0
            for k, v in pairs(value) do
                count = count + 1
                if count > 50 then -- Limit table size
                    table.insert(parts, "-- ... (table too large)")
                    break
                end
                local keyStr = type(k) == "number" and "[" .. k .. "]" or "[\"" .. tostring(k) .. "\"]"
                table.insert(parts, keyStr .. " = " .. GigaChadSpy.SerializeValue(v, depth + 1))
            end
            return "{" .. table.concat(parts, ", ") .. "}"
        elseif valueType == "Vector3" then
            return "Vector3.new(" .. value.X .. ", " .. value.Y .. ", " .. value.Z .. ")"
        elseif valueType == "CFrame" then
            local components = {value:GetComponents()}
            return "CFrame.new(" .. table.concat(components, ", ") .. ")"
        elseif valueType == "Color3" then
            return "Color3.new(" .. value.R .. ", " .. value.G .. ", " .. value.B .. ")"
        elseif valueType == "Instance" then
            return GigaChadSpy.GetPath(value)
        elseif valueType == "nil" then
            return "nil"
        else
            return "\"" .. tostring(value) .. "\""
        end
    end)
    
    return success and result or "\"<serialization_error>\""
end

function GigaChadSpy.GenerateCode(remoteName, remoteType, args, path)
    local code = ""
    
    if #args > 0 then
        code = code .. "local giga = {\n"
        for i, arg in ipairs(args) do
            if i <= 20 then -- Limit args displayed
                code = code .. "    [" .. i .. "] = " .. GigaChadSpy.SerializeValue(arg) .. ",\n"
            else
                code = code .. "    -- ... (" .. (#args - 20) .. " more arguments)\n"
                break
            end
        end
        code = code .. "}\n\n"
        
        if remoteType == "Event" then
            code = code .. path .. ":FireServer(unpack(giga))"
        else
            code = code .. path .. ":InvokeServer(unpack(giga))"
        end
    else
        if remoteType == "Event" then
            code = code .. path .. ":FireServer()"
        else
            code = code .. path .. ":InvokeServer()"
        end
    end
    
    return code
end

-- UI Functions with better error handling
function GigaChadSpy.AddRemote(remoteName, remoteType, direction, args, path)
    if not remoteName or GigaChadSpy.BlockedRemotes[remoteName] then 
        return 
    end
    
    -- Clean old logs if exceeding max
    while #GigaChadSpy.Remotes >= GigaChadSpy.MaxLogs do
        local oldRemote = table.remove(GigaChadSpy.Remotes, 1)
        if oldRemote and oldRemote:IsDescendantOf(LeftPanel) then
            oldRemote:Destroy()
        end
    end
    
    local remoteClone = RemoteTemplate:Clone()
    remoteClone.Parent = LeftPanel
    remoteClone.Visible = true
    
    -- Set colors based on type and direction
    local iconColor, typeColor, typeText
    if remoteType == "Event" then
        if direction == "‚Üí" then
            iconColor = Color3.fromRGB(255, 255, 0)  -- Yellow for Event ‚Üí Server
            typeColor = Color3.fromRGB(200, 200, 0)
            typeText = "Event ‚Üí Server"
        else
            iconColor = Color3.fromRGB(150, 150, 0)  -- Dark Yellow for Event ‚Üê Server
            typeColor = Color3.fromRGB(120, 120, 0)
            typeText = "Event ‚Üê Server"
        end
    else
        if direction == "‚Üí" then
            iconColor = Color3.fromRGB(180, 0, 255)  -- Purple for Function ‚Üí Server
            typeColor = Color3.fromRGB(140, 0, 200)
            typeText = "Function ‚Üí Server"
        else
            iconColor = Color3.fromRGB(100, 0, 150)  -- Dark Purple for Function ‚Üê Server
            typeColor = Color3.fromRGB(80, 0, 120)
            typeText = "Function ‚Üê Server"
        end
    end
    
    remoteClone.RemoteIcon.BackgroundColor3 = iconColor
    remoteClone.RemoteName.Text = tostring(remoteName):sub(1, 50) -- Limit name length
    remoteClone.RemoteType.Text = typeText
    remoteClone.RemoteType.TextColor3 = typeColor
    
    -- Position the new remote
    local yPosition = (#GigaChadSpy.Remotes * 70) + 5
    remoteClone.Position = UDim2.new(0, 6, 0, yPosition)
    
    -- Store remote data
    local remoteData = {
        Frame = remoteClone,
        Name = remoteName,
        Type = remoteType,
        Direction = direction,
        Args = args,
        Path = path,
        Code = GigaChadSpy.GenerateCode(remoteName, remoteType, args, path)
    }
    
    table.insert(GigaChadSpy.Remotes, remoteClone)
    
    -- Click event
    remoteClone.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            GigaChadSpy.ShowCode(remoteData)
        end
    end)
    
    -- Update canvas size
    LeftPanel.CanvasSize = UDim2.new(0, 0, 0, yPosition + 70)
end

function GigaChadSpy.ShowCode(remoteData)
    GigaChadSpy.CurrentRemote = remoteData
    CodeFrame:ClearAllChildren()
    
    if not remoteData or not remoteData.Code then return end
    
    local lines = {}
    for line in remoteData.Code:gmatch("[^\r\n]+") do
        table.insert(lines, line)
    end
    
    for i, line in ipairs(lines) do
        local codeLine = CodeTemplate:Clone()
        codeLine.Parent = CodeFrame
        codeLine.Visible = true
        codeLine.Text = line
        codeLine.Position = UDim2.new(0, 5, 0, (i-1) * 28)
        codeLine.Size = UDim2.new(1, -10, 0, 25)
    end
    
    CodeFrame.CanvasSize = UDim2.new(0, 0, 0, #lines * 28)
end

function GigaChadSpy.ClearLogs()
    for _, remote in ipairs(GigaChadSpy.Remotes) do
        if remote:IsDescendantOf(LeftPanel) then
            remote:Destroy()
        end
    end
    GigaChadSpy.Remotes = {}
    CodeFrame:ClearAllChildren()
    LeftPanel.CanvasSize = UDim2.new(0, 0, 0, 0)
    GigaChadSpy.CurrentRemote = nil
end

function GigaChadSpy.BlockRemote(remoteName)
    if remoteName then
        GigaChadSpy.BlockedRemotes[remoteName] = true
    end
end

function GigaChadSpy.ClearBlocks()
    GigaChadSpy.BlockedRemotes = {}
end

function GigaChadSpy.ToggleAutoBlock()
    GigaChadSpy.AutoBlock = not GigaChadSpy.AutoBlock
    AutoBlockButton.Text = GigaChadSpy.AutoBlock and "ü§ñ Auto: ON" or "ü§ñ Auto: OFF"
    AutoBlockButton.BackgroundColor3 = GigaChadSpy.AutoBlock and Color3.fromRGB(60, 120, 60) or Color3.fromRGB(35, 35, 35)
end

function GigaChadSpy.CopyCode()
    if GigaChadSpy.CurrentRemote and GigaChadSpy.CurrentRemote.Code then
        pcall(function()
            setclipboard(GigaChadSpy.CurrentRemote.Code)
        end)
    end
end

function GigaChadSpy.ReFire()
    if GigaChadSpy.CurrentRemote and GigaChadSpy.CurrentRemote.Code then
        local success, result = pcall(function()
            loadstring(GigaChadSpy.CurrentRemote.Code)()
        end)
        if not success then
            warn("[GigaChad Spy] Error refiring remote: " .. tostring(result))
        end
    end
end

-- Safe hooking function
function GigaChadSpy.HookRemotes()
    if GigaChadSpy.IsHooked then return end
    
    local success, errorMsg = pcall(function()
        local gameMeta = getrawmetatable(game)
        if not gameMeta then return end
        
        local oldNamecall = gameMeta.__namecall
        
        setreadonly(gameMeta, false)
        
        gameMeta.__namecall = newcclosure(function(self, ...)
            local method = getnamecallmethod()
            local args = {...}
            
            if method == "FireServer" or method == "InvokeServer" then
                local remoteType = method == "FireServer" and "Event" or "Function"
                local remoteName = tostring(self.Name)
                
                if GigaChadSpy.AutoBlock then
                    GigaChadSpy.BlockRemote(remoteName)
                end
                
                if not GigaChadSpy.BlockedRemotes[remoteName] then
                    local path = GigaChadSpy.GetPath(self)
                    GigaChadSpy.AddRemote(remoteName, remoteType, "‚Üí", args, path)
                end
            end
            
            return oldNamecall(self, ...)
        end)
        
        setreadonly(gameMeta, true)
        GigaChadSpy.IsHooked = true
    end)
    
    if not success then
        warn("[GigaChad Spy] Hook error: " .. tostring(errorMsg))
    end
end

-- UI Events with error handling
local function SafeConnect(button, callback)
    button.MouseButton1Click:Connect(function()
        local success, err = pcall(callback)
        if not success then
            warn("[GigaChad Spy] UI Error: " .. tostring(err))
        end
    end)
end

SafeConnect(FloatingButton, function()
    MainFrame.Visible = not MainFrame.Visible
    if MainFrame.Visible and not GigaChadSpy.IsHooked then
        GigaChadSpy.HookRemotes()
    end
end)

SafeConnect(CloseButton, function()
    MainFrame.Visible = false
end)

SafeConnect(ClearLogsButton, function()
    GigaChadSpy.ClearLogs()
end)

SafeConnect(ClearBlocksButton, function()
    GigaChadSpy.ClearBlocks()
end)

SafeConnect(AutoBlockButton, function()
    GigaChadSpy.ToggleAutoBlock()
end)

SafeConnect(CopyButton, function()
    GigaChadSpy.CopyCode()
end)

SafeConnect(ReFireButton, function()
    GigaChadSpy.ReFire()
end)

SafeConnect(BlockButton, function()
    if GigaChadSpy.CurrentRemote then
        GigaChadSpy.BlockRemote(GigaChadSpy.CurrentRemote.Name)
        if GigaChadSpy.CurrentRemote.Frame and GigaChadSpy.CurrentRemote.Frame:IsDescendantOf(LeftPanel) then
            GigaChadSpy.CurrentRemote.Frame:Destroy()
        end
    end
end)

SafeConnect(DecompileButton, function()
    -- Safe decompile placeholder
    print("[GigaChad Spy] Decompile feature would show source script here")
end)

-- Make UI draggable with safe implementation
local dragging = false
local dragInput, dragStart, startPos

local function update(input)
    if not dragging then return end
    
    local delta = input.Position - dragStart
    local newX = startPos.X.Offset + delta.X
    local newY = startPos.Y.Offset + delta.Y
    
    -- Keep within screen bounds
    newX = math.clamp(newX, 0, workspace.CurrentCamera.ViewportSize.X - MainFrame.AbsoluteSize.X)
    newY = math.clamp(newY, 0, workspace.CurrentCamera.ViewportSize.Y - MainFrame.AbsoluteSize.Y)
    
    MainFrame.Position = UDim2.new(0, newX, 0, newY)
end

TopBar.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = MainFrame.Position
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

TopBar.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement then
        dragInput = input
    end
end)

game:GetService("UserInputService").InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        update(input)
    end
end)

-- Mobile optimization
if game:GetService("UserInputService").TouchEnabled then
    MainFrame.Size = UDim2.new(0.95, 0, 0.9, 0)
    MainFrame.Position = UDim2.new(0.025, 0, 0.05, 0)
    FloatingButton.Size = UDim2.new(0, 80, 0, 80)
    
    -- Adjust font sizes for mobile
    local textElements = {
        Title, RemoteName, RemoteType, ReFireButton, CopyButton, 
        BlockButton, ClearLogsButton, ClearBlocksButton, AutoBlockButton, DecompileButton
    }
    
    for _, element in ipairs(textElements) do
        if element:IsA("TextLabel") or element:IsA("TextButton") then
            element.TextSize = 16
        end
    end
end

-- Initialize
GigaChadSpy.HookRemotes()
print("[GigaChad Spy] Loaded successfully! Click GCS button to open.")

-- Auto-cleanup on game close
game:GetService("Players").LocalPlayer:WaitForChild("PlayerGui").ChildRemoved:Connect(function(child)
    if child == GigaChadSpy then
        GigaChadSpy.ClearLogs()
    end
end)
