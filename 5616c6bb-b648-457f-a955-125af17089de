local GigaChadSpy = Instance.new("ScreenGui")
local FloatingButton = Instance.new("TextButton")
local MainFrame = Instance.new("Frame")
local TopBar = Instance.new("Frame")
local Title = Instance.new("TextLabel")
local CloseButton = Instance.new("TextButton")
local Content = Instance.new("Frame")
local LeftPanel = Instance.new("ScrollingFrame")
local RemoteTemplate = Instance.new("Frame")
local RemoteIcon = Instance.new("TextLabel")
local RemoteName = Instance.new("TextLabel")
local RemoteType = Instance.new("TextLabel")
local RightPanel = Instance.new("Frame")
local CodeFrame = Instance.new("ScrollingFrame")
local CodeTemplate = Instance.new("TextLabel")
local ButtonsFrame = Instance.new("Frame")
local ReFireButton = Instance.new("TextButton")
local CopyButton = Instance.new("TextButton")
local BlockButton = Instance.new("TextButton")
local ClearLogsButton = Instance.new("TextButton")
local ClearBlocksButton = Instance.new("TextButton")
local AutoBlockButton = Instance.new("TextButton")
local DecompileButton = Instance.new("TextButton")

-- Properties
GigaChadSpy.Name = "GigaChadSpy"
GigaChadSpy.Parent = game.CoreGui
GigaChadSpy.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

-- Floating Button
FloatingButton.Name = "FloatingButton"
FloatingButton.Parent = GigaChadSpy
FloatingButton.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
FloatingButton.BorderSizePixel = 0
FloatingButton.Position = UDim2.new(0, 20, 0, 20)
FloatingButton.Size = UDim2.new(0, 60, 0, 60)
FloatingButton.ZIndex = 100
FloatingButton.Font = Enum.Font.Cartoon
FloatingButton.Text = "GCS"
FloatingButton.TextColor3 = Color3.fromRGB(255, 255, 255)
FloatingButton.TextScaled = true
FloatingButton.RichText = true
FloatingButton.Visible = true

-- Main Frame
MainFrame.Name = "MainFrame"
MainFrame.Parent = GigaChadSpy
MainFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
MainFrame.BorderSizePixel = 0
MainFrame.Position = UDim2.new(0.1, 0, 0.1, 0)
MainFrame.Size = UDim2.new(0.8, 0, 0.8, 0)
MainFrame.Visible = false

-- Top Bar
TopBar.Name = "TopBar"
TopBar.Parent = MainFrame
TopBar.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
TopBar.BorderSizePixel = 0
TopBar.Size = UDim2.new(1, 0, 0, 40)

Title.Name = "Title"
Title.Parent = TopBar
Title.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
Title.BorderSizePixel = 0
Title.Size = UDim2.new(0.8, 0, 1, 0)
Title.Font = Enum.Font.Cartoon
Title.Text = "GigaChad Spy"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.TextScaled = true
Title.RichText = true

CloseButton.Name = "CloseButton"
CloseButton.Parent = TopBar
CloseButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
CloseButton.BorderSizePixel = 0
CloseButton.Position = UDim2.new(0.9, 0, 0, 0)
CloseButton.Size = UDim2.new(0.1, 0, 1, 0)
CloseButton.Font = Enum.Font.Cartoon
CloseButton.Text = "X"
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.TextScaled = true
CloseButton.RichText = true

-- Content
Content.Name = "Content"
Content.Parent = MainFrame
Content.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
Content.BorderSizePixel = 0
Content.Position = UDim2.new(0, 0, 0, 40)
Content.Size = UDim2.new(1, 0, 1, -40)

-- Left Panel
LeftPanel.Name = "LeftPanel"
LeftPanel.Parent = Content
LeftPanel.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
LeftPanel.BorderSizePixel = 0
LeftPanel.Size = UDim2.new(0.4, 0, 1, 0)
LeftPanel.CanvasSize = UDim2.new(0, 0, 2, 0)
LeftPanel.ScrollBarThickness = 5

-- Remote Template
RemoteTemplate.Name = "RemoteTemplate"
RemoteTemplate.Parent = LeftPanel
RemoteTemplate.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
RemoteTemplate.BorderSizePixel = 0
RemoteTemplate.Size = UDim2.new(1, -10, 0, 60)
RemoteTemplate.Visible = false

RemoteIcon.Name = "RemoteIcon"
RemoteIcon.Parent = RemoteTemplate
RemoteIcon.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
RemoteIcon.BorderSizePixel = 0
RemoteIcon.Position = UDim2.new(0, 5, 0, 5)
RemoteIcon.Size = UDim2.new(0, 50, 0, 50)
RemoteIcon.Font = Enum.Font.Cartoon
RemoteIcon.Text = "üîç"
RemoteIcon.TextColor3 = Color3.fromRGB(255, 255, 255)
RemoteIcon.TextScaled = true
RemoteIcon.RichText = true

RemoteName.Name = "RemoteName"
RemoteName.Parent = RemoteTemplate
RemoteName.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
RemoteName.BorderSizePixel = 0
RemoteName.Position = UDim2.new(0, 60, 0, 5)
RemoteName.Size = UDim2.new(1, -65, 0, 30)
RemoteName.Font = Enum.Font.Cartoon
RemoteName.Text = "RemoteName"
RemoteName.TextColor3 = Color3.fromRGB(255, 255, 255)
RemoteName.TextScaled = true
RemoteName.RichText = true
RemoteName.TextXAlignment = Enum.TextXAlignment.Left

RemoteType.Name = "RemoteType"
RemoteType.Parent = RemoteTemplate
RemoteType.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
RemoteType.BorderSizePixel = 0
RemoteType.Position = UDim2.new(0, 60, 0, 35)
RemoteType.Size = UDim2.new(1, -65, 0, 20)
RemoteType.Font = Enum.Font.Cartoon
RemoteType.Text = "Event ‚Üí Server"
RemoteType.TextColor3 = Color3.fromRGB(200, 200, 200)
RemoteType.TextScaled = true
RemoteType.RichText = true
RemoteType.TextXAlignment = Enum.TextXAlignment.Left

-- Right Panel
RightPanel.Name = "RightPanel"
RightPanel.Parent = Content
RightPanel.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
RightPanel.BorderSizePixel = 0
RightPanel.Position = UDim2.new(0.4, 0, 0, 0)
RightPanel.Size = UDim2.new(0.6, 0, 1, 0)

CodeFrame.Name = "CodeFrame"
CodeFrame.Parent = RightPanel
CodeFrame.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
CodeFrame.BorderSizePixel = 0
CodeFrame.Size = UDim2.new(1, 0, 0.7, 0)
CodeFrame.CanvasSize = UDim2.new(0, 0, 2, 0)
CodeFrame.ScrollBarThickness = 5

CodeTemplate.Name = "CodeTemplate"
CodeTemplate.Parent = CodeFrame
CodeTemplate.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
CodeTemplate.BorderSizePixel = 0
CodeTemplate.Size = UDim2.new(1, -10, 0, 30)
CodeTemplate.Visible = false
CodeTemplate.Font = Enum.Font.Code
CodeTemplate.Text = "local data = {}"
CodeTemplate.TextColor3 = Color3.fromRGB(255, 255, 255)
CodeTemplate.TextScaled = true
CodeTemplate.RichText = true
CodeTemplate.TextXAlignment = Enum.TextXAlignment.Left

ButtonsFrame.Name = "ButtonsFrame"
ButtonsFrame.Parent = RightPanel
ButtonsFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
ButtonsFrame.BorderSizePixel = 0
ButtonsFrame.Position = UDim2.new(0, 0, 0.7, 0)
ButtonsFrame.Size = UDim2.new(1, 0, 0.3, 0)

-- Buttons
local buttonProps = {
    BackgroundColor3 = Color3.fromRGB(40, 40, 40),
    BorderSizePixel = 0,
    Font = Enum.Font.Cartoon,
    TextColor3 = Color3.fromRGB(255, 255, 255),
    TextScaled = true,
    RichText = true
}

ReFireButton.Name = "ReFireButton"
ReFireButton.Parent = ButtonsFrame
ReFireButton.Size = UDim2.new(0.33, -2, 0.5, -2)
ReFireButton.Position = UDim2.new(0, 1, 0, 1)
ReFireButton.Text = "Refire"
for prop, value in pairs(buttonProps) do
    ReFireButton[prop] = value
end

CopyButton.Name = "CopyButton"
CopyButton.Parent = ButtonsFrame
CopyButton.Size = UDim2.new(0.33, -2, 0.5, -2)
CopyButton.Position = UDim2.new(0.33, 1, 0, 1)
CopyButton.Text = "Copy"
for prop, value in pairs(buttonProps) do
    CopyButton[prop] = value
end

BlockButton.Name = "BlockButton"
BlockButton.Parent = ButtonsFrame
BlockButton.Size = UDim2.new(0.33, -2, 0.5, -2)
BlockButton.Position = UDim2.new(0.66, 1, 0, 1)
BlockButton.Text = "Block"
for prop, value in pairs(buttonProps) do
    BlockButton[prop] = value
end

ClearLogsButton.Name = "ClearLogsButton"
ClearLogsButton.Parent = ButtonsFrame
ClearLogsButton.Size = UDim2.new(0.33, -2, 0.5, -2)
ClearLogsButton.Position = UDim2.new(0, 1, 0.5, 1)
ClearLogsButton.Text = "Clear Logs"
for prop, value in pairs(buttonProps) do
    ClearLogsButton[prop] = value
end

ClearBlocksButton.Name = "ClearBlocksButton"
ClearBlocksButton.Parent = ButtonsFrame
ClearBlocksButton.Size = UDim2.new(0.33, -2, 0.5, -2)
ClearBlocksButton.Position = UDim2.new(0.33, 1, 0.5, 1)
ClearBlocksButton.Text = "Clear Blocks"
for prop, value in pairs(buttonProps) do
    ClearBlocksButton[prop] = value
end

AutoBlockButton.Name = "AutoBlockButton"
AutoBlockButton.Parent = ButtonsFrame
AutoBlockButton.Size = UDim2.new(0.33, -2, 0.5, -2)
AutoBlockButton.Position = UDim2.new(0.66, 1, 0.5, 1)
AutoBlockButton.Text = "Auto Block: OFF"
for prop, value in pairs(buttonProps) do
    AutoBlockButton[prop] = value
end

DecompileButton.Name = "DecompileButton"
DecompileButton.Parent = ButtonsFrame
DecompileButton.Size = UDim2.new(1, -2, 0.5, -2)
DecompileButton.Position = UDim2.new(0, 1, 1, -50)
DecompileButton.Text = "Decompile Source"
for prop, value in pairs(buttonProps) do
    DecompileButton[prop] = value
end

-- Spy Logic
local GigaChadSpy = {}
GigaChadSpy.Remotes = {}
GigaChadSpy.BlockedRemotes = {}
GigaChadSpy.MaxLogs = 200
GigaChadSpy.AutoBlock = false
GigaChadSpy.CurrentRemote = nil

-- Utility Functions
function GigaChadSpy.GetPath(instance)
    local path = {}
    local current = instance
    
    while current and current ~= game do
        table.insert(path, 1, current.Name)
        current = current.Parent
    end
    
    return "game:GetService(\"" .. tostring(instance.Parent.ClassName) .. "\")" .. table.concat(path, ".")
end

function GigaChadSpy.SerializeValue(value)
    local valueType = typeof(value)
    
    if valueType == "string" then
        return "\"" .. value .. "\""
    elseif valueType == "number" then
        return tostring(value)
    elseif valueType == "boolean" then
        return tostring(value)
    elseif valueType == "table" then
        local parts = {}
        for k, v in pairs(value) do
            table.insert(parts, "[" .. GigaChadSpy.SerializeValue(k) .. "] = " .. GigaChadSpy.SerializeValue(v))
        end
        return "{" .. table.concat(parts, ", ") .. "}"
    elseif valueType == "Vector3" then
        return "Vector3.new(" .. value.X .. ", " .. value.Y .. ", " .. value.Z .. ")"
    elseif valueType == "CFrame" then
        return "CFrame.new(" .. tostring(value) .. ")"
    elseif valueType == "Color3" then
        return "Color3.new(" .. value.R .. ", " .. value.G .. ", " .. value.B .. ")"
    elseif valueType == "Instance" then
        return GigaChadSpy.GetPath(value)
    else
        return tostring(value)
    end
end

function GigaChadSpy.GenerateCode(remoteName, remoteType, args, path)
    local code = ""
    
    if #args > 0 then
        code = code .. "local giga = {\n"
        for i, arg in ipairs(args) do
            code = code .. "    [" .. i .. "] = " .. GigaChadSpy.SerializeValue(arg) .. ",\n"
        end
        code = code .. "}\n\n"
        
        if remoteType == "Event" then
            code = code .. path .. ":FireServer(unpack(giga))"
        else
            code = code .. path .. ":InvokeServer(unpack(giga))"
        end
    else
        if remoteType == "Event" then
            code = code .. path .. ":FireServer()"
        else
            code = code .. path .. ":InvokeServer()"
        end
    end
    
    return code
end

-- UI Functions
function GigaChadSpy.AddRemote(remoteName, remoteType, direction, args, path)
    if GigaChadSpy.BlockedRemotes[remoteName] then return end
    
    if #GigaChadSpy.Remotes >= GigaChadSpy.MaxLogs then
        GigaChadSpy.Remotes[1]:Destroy()
        table.remove(GigaChadSpy.Remotes, 1)
    end
    
    local remoteClone = RemoteTemplate:Clone()
    remoteClone.Parent = LeftPanel
    remoteClone.Visible = true
    
    -- Set colors based on type and direction
    local iconColor, typeColor, typeText
    if remoteType == "Event" then
        if direction == "‚Üí" then
            iconColor = Color3.fromRGB(255, 255, 0)  -- Yellow for Event ‚Üí Server
            typeColor = Color3.fromRGB(200, 200, 0)
            typeText = "Event ‚Üí Server"
        else
            iconColor = Color3.fromRGB(150, 150, 0)  -- Dark Yellow for Event ‚Üê Server
            typeColor = Color3.fromRGB(120, 120, 0)
            typeText = "Event ‚Üê Server"
        end
    else
        if direction == "‚Üí" then
            iconColor = Color3.fromRGB(180, 0, 255)  -- Purple for Function ‚Üí Server
            typeColor = Color3.fromRGB(140, 0, 200)
            typeText = "Function ‚Üí Server"
        else
            iconColor = Color3.fromRGB(100, 0, 150)  -- Dark Purple for Function ‚Üê Server
            typeColor = Color3.fromRGB(80, 0, 120)
            typeText = "Function ‚Üê Server"
        end
    end
    
    remoteClone.RemoteIcon.BackgroundColor3 = iconColor
    remoteClone.RemoteName.Text = remoteName
    remoteClone.RemoteType.Text = typeText
    remoteClone.RemoteType.TextColor3 = typeColor
    
    -- Position the new remote
    remoteClone.Position = UDim2.new(0, 5, 0, (#GigaChadSpy.Remotes * 65) + 5)
    
    -- Store remote data
    local remoteData = {
        Frame = remoteClone,
        Name = remoteName,
        Type = remoteType,
        Direction = direction,
        Args = args,
        Path = path,
        Code = GigaChadSpy.GenerateCode(remoteName, remoteType, args, path)
    }
    
    table.insert(GigaChadSpy.Remotes, remoteClone)
    
    -- Click event
    remoteClone.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            GigaChadSpy.ShowCode(remoteData)
        end
    end)
    
    -- Update canvas size
    LeftPanel.CanvasSize = UDim2.new(0, 0, 0, (#GigaChadSpy.Remotes * 65) + 10)
end

function GigaChadSpy.ShowCode(remoteData)
    GigaChadSpy.CurrentRemote = remoteData
    CodeFrame:ClearAllChildren()
    
    local lines = {}
    for line in remoteData.Code:gmatch("[^\r\n]+") do
        table.insert(lines, line)
    end
    
    for i, line in ipairs(lines) do
        local codeLine = CodeTemplate:Clone()
        codeLine.Parent = CodeFrame
        codeLine.Visible = true
        codeLine.Text = line
        codeLine.Position = UDim2.new(0, 5, 0, (i-1) * 35)
    end
    
    CodeFrame.CanvasSize = UDim2.new(0, 0, 0, #lines * 35)
end

function GigaChadSpy.ClearLogs()
    for _, remote in ipairs(GigaChadSpy.Remotes) do
        remote:Destroy()
    end
    GigaChadSpy.Remotes = {}
    CodeFrame:ClearAllChildren()
    LeftPanel.CanvasSize = UDim2.new(0, 0, 0, 0)
end

function GigaChadSpy.BlockRemote(remoteName)
    GigaChadSpy.BlockedRemotes[remoteName] = true
end

function GigaChadSpy.ClearBlocks()
    GigaChadSpy.BlockedRemotes = {}
end

function GigaChadSpy.ToggleAutoBlock()
    GigaChadSpy.AutoBlock = not GigaChadSpy.AutoBlock
    AutoBlockButton.Text = "Auto Block: " .. (GigaChadSpy.AutoBlock and "ON" or "OFF")
end

function GigaChadSpy.CopyCode()
    if GigaChadSpy.CurrentRemote then
        setclipboard(GigaChadSpy.CurrentRemote.Code)
    end
end

function GigaChadSpy.ReFire()
    if GigaChadSpy.CurrentRemote then
        local success, result = pcall(function()
            loadstring(GigaChadSpy.CurrentRemote.Code)()
        end)
        if not success then
            warn("Error refiring remote: " .. result)
        end
    end
end

-- Hook into remotes
local gameMeta = getrawmetatable(game)
local oldNamecall = gameMeta.__namecall

setreadonly(gameMeta, false)

gameMeta.__namecall = newcclosure(function(self, ...)
    local method = getnamecallmethod()
    local args = {...}
    
    if method == "FireServer" or method == "InvokeServer" then
        local remoteType = method == "FireServer" and "Event" or "Function"
        local remoteName = self.Name
        
        if GigaChadSpy.AutoBlock then
            GigaChadSpy.BlockRemote(remoteName)
        end
        
        if not GigaChadSpy.BlockedRemotes[remoteName] then
            GigaChadSpy.AddRemote(remoteName, remoteType, "‚Üí", args, GigaChadSpy.GetPath(self))
        end
    end
    
    return oldNamecall(self, ...)
end)

-- Also hook for incoming remotes from server
local oldIndex = gameMeta.__index

gameMeta.__index = newcclosure(function(self, key)
    if key == "OnClientEvent" or key == "OnClientInvoke" then
        local remoteType = key == "OnClientEvent" and "Event" and "Function"
        local remoteName = self.Name
        
        return function(callback)
            return oldIndex(self, key):Connect(function(...)
                local args = {...}
                
                if not GigaChadSpy.BlockedRemotes[remoteName] then
                    GigaChadSpy.AddRemote(remoteName, remoteType, "‚Üê", args, GigaChadSpy.GetPath(self))
                end
                
                return callback(...)
            end)
        end
    end
    
    return oldIndex(self, key)
end)

setreadonly(gameMeta, true)

-- UI Events
FloatingButton.MouseButton1Click:Connect(function()
    MainFrame.Visible = not MainFrame.Visible
end)

CloseButton.MouseButton1Click:Connect(function()
    MainFrame.Visible = false
end)

ClearLogsButton.MouseButton1Click:Connect(function()
    GigaChadSpy.ClearLogs()
end)

ClearBlocksButton.MouseButton1Click:Connect(function()
    GigaChadSpy.ClearBlocks()
end)

AutoBlockButton.MouseButton1Click:Connect(function()
    GigaChadSpy.ToggleAutoBlock()
end)

CopyButton.MouseButton1Click:Connect(function()
    GigaChadSpy.CopyCode()
end)

ReFireButton.MouseButton1Click:Connect(function()
    GigaChadSpy.ReFire()
end)

BlockButton.MouseButton1Click:Connect(function()
    if GigaChadSpy.CurrentRemote then
        GigaChadSpy.BlockRemote(GigaChadSpy.CurrentRemote.Name)
    end
end)

DecompileButton.MouseButton1Click:Connect(function()
    -- Decompile functionality would go here
    print("Decompile feature - would show source script here")
end)

-- Make UI draggable
local dragging
local dragInput
local dragStart
local startPos

local function update(input)
    local delta = input.Position - dragStart
    MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end

TopBar.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = MainFrame.Position
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

TopBar.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement then
        dragInput = input
    end
end)

game:GetService("UserInputService").InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        update(input)
    end
end)

-- Mobile optimization
if game:GetService("UserInputService").TouchEnabled then
    MainFrame.Size = UDim2.new(0.9, 0, 0.9, 0)
    MainFrame.Position = UDim2.new(0.05, 0, 0.05, 0)
    
    -- Make text slightly larger for mobile
    local textLabels = {
        Title, RemoteName, RemoteType, ReFireButton, CopyButton, 
        BlockButton, ClearLogsButton, ClearBlocksButton, AutoBlockButton, DecompileButton
    }
    
    for _, label in ipairs(textLabels) do
        label.TextSize = 18
    end
end

print("GigaChad Spy loaded! Click the GCS button to open.")
